<%- include('../partials/user/header') %>

<style>
	.single-product {
    overflow: hidden;
    transition: transform 0.3s ease-in-out;
}

.single-product:hover img {
    transform: scale(1.1);
}

.single-product img {
    transition: transform 0.3s ease-in-out;
    width: 100%;
}

.single-product .product-details h6,
.single-product .social-info p {
    transition: color 0.3s ease-in-out;
}

.single-product:hover .product-details h6,
.single-product:hover .social-info p {
    color: #ffbb00;
}
</style>

	<!-- Start Banner Area -->
	<section class="banner-area organic-breadcrumb">
		<div class="container">
			<div class="breadcrumb-banner d-flex flex-wrap align-items-center justify-content-end">
				<div class="col-first">
					<h1>Shoping page</h1>
					<nav class="d-flex align-items-center">
						<a href="/">Home<span class="lnr lnr-arrow-right"></span></a>
						<a href="#">Shop Category</a>
					</nav>
				</div>
			</div>
		</div>
	</section>
	<!-- End Banner Area -->


	<!-- Start Advanced Search and Sort -->
<div class="container mt-4">
	<div class="row">
	  <div class="col-md-12">
		<div class="advanced-search-sort">
		  <form action="/shop" method="GET" class="form-inline">
			<div class="form-group mr-2">
			  <input type="text" id="advanced-search-glow" name="search" class="form-control" placeholder="Search products...">
			</div>
			<div class="form-group mr-2">
			  <select name="sort" class="form-control">
				<option value="">Sort by...</option>
				<option value="popularity">Popularity</option>
				<option value="price_asc">Price: Low to High</option>
				<option value="price_desc">Price: High to Low</option>
				<option value="rating">Average Ratings</option>
				<option value="featured">Featured</option>
				<option value="new">New Arrivals</option>
				<option value="name_asc">Name: A to Z</option>
				<option value="name_desc">Name: Z to A</option>
			  </select>
			</div>
			<button type="submit" class="btn btn-primary">Apply</button>
			<a href="/shop"><button class="btn btn-danger">Clear All</button></a>
		  </form>
		  
		</div>
	  </div>
	</div>
  </div>
  <!-- End Advanced Search and Sort -->
   <br>

	

	<div class="container">
		<div class="row">
			<div class="col-xl-3 col-lg-4 col-md-5">
				<div class="sidebar-categories">
					<div class="head">Browse Categories</div>
					<ul class="main-categories">
                        
                        <% for(let i=0;i< category.length;i++){%>
						<li class="main-nav-list"><a href="/filter?category=<%=category[i]._id%>" aria-expanded="false" ><span
								 class="lnr lnr-arrow-right"></span><%=category[i].name%><span class="number">(<%= category[i].productCount %>)</span></a>
						</li>
                        <%}%>

					</ul>
				</div>
				<div class="sidebar-filter mt-50">
					<!-- <div class="top-filter-head">Product Filters</div> -->
					<!-- <div class="common-filter">
						<div class="head">Brands</div>
						<form action="#">
							<ul>
								<li class="filter-list"><input class="pixel-radio" type="radio" id="apple" name="brand"><label for="apple">Apple<span>(29)</span></label></li>
								<li class="filter-list"><input class="pixel-radio" type="radio" id="asus" name="brand"><label for="asus">Asus<span>(29)</span></label></li>
								<li class="filter-list"><input class="pixel-radio" type="radio" id="gionee" name="brand"><label for="gionee">Gionee<span>(19)</span></label></li>
								<li class="filter-list"><input class="pixel-radio" type="radio" id="micromax" name="brand"><label for="micromax">Micromax<span>(19)</span></label></li>
								<li class="filter-list"><input class="pixel-radio" type="radio" id="samsung" name="brand"><label for="samsung">Samsung<span>(19)</span></label></li>
							</ul>
						</form>
					</div>
					<div class="common-filter">
						<div class="head">Color</div>
						<form action="#">
							<ul>
								<li class="filter-list"><input class="pixel-radio" type="radio" id="black" name="color"><label for="black">Black<span>(29)</span></label></li>
								<li class="filter-list"><input class="pixel-radio" type="radio" id="balckleather" name="color"><label for="balckleather">Black
										Leather<span>(29)</span></label></li>
								<li class="filter-list"><input class="pixel-radio" type="radio" id="blackred" name="color"><label for="blackred">Black
										with red<span>(19)</span></label></li>
								<li class="filter-list"><input class="pixel-radio" type="radio" id="gold" name="color"><label for="gold">Gold<span>(19)</span></label></li>
								<li class="filter-list"><input class="pixel-radio" type="radio" id="spacegrey" name="color"><label for="spacegrey">Spacegrey<span>(19)</span></label></li>
							</ul>
						</form>
					</div> -->
					<!-- <div class="common-filter">
						<div class="head">Price</div>
						<div class="price-range-area">
							<div id="price-range"></div>
							<div class="value-wrapper d-flex">
								<div class="price">Price:</div>
								<span>₹</span>
								<div id="lower-value">100</div>
								<div class="to">to</div>
								<span>₹</span>
								<div id="upper-value">500000</div>
							</div>
						</div>
					</div> -->
				</div>
			</div>
			<div class="col-xl-9 col-lg-8 col-md-7">
				<!-- Start Filter Bar -->
				<div class="filter-bar d-flex flex-wrap align-items-center">
					<div class="sorting">
						<select>
							<option value="1">Default sorting</option>
							<!-- <option value="1">Default sorting</option>
							<option value="1">Default sorting</option> -->
						</select>
					</div>
					<div class="sorting mr-auto">
						<select>
							<option value="1">Show 9</option>
							<!-- <option value="1">Show 12</option>
							<option value="1">Show 12</option> -->
						</select>
					</div>
					<div class="pagination">
                        <% if (currentPage > 1) { %>
                            <a href="/shop?page=<%= currentPage - 1 %>" class="prev-arrow">
                                <i class="fa fa-long-arrow-left" aria-hidden="true"></i>
                            </a>
                        <% } %>
                    
                        <% if (totalPages > 5 && currentPage > 3) { %>
                            <a href="/shop?page=1">1</a>
                            <% if (currentPage > 4) { %>
                                <a href="#" class="dot-dot">
                                    <i class="fa fa-ellipsis-h" aria-hidden="true"></i>
                                </a>
                            <% } %>
                        <% } %>
                    
                        <% for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) { %>
                            <a href="/shop?page=<%= i %>" class="<%= currentPage === i ? 'active' : '' %>"><%= i %></a>
                        <% } %>
                    
                        <% if (totalPages > 5 && currentPage < totalPages - 2) { %>
                            <% if (currentPage < totalPages - 3) { %>
                                <a href="#" class="dot-dot">
                                    <i class="fa fa-ellipsis-h" aria-hidden="true"></i>
                                </a>
                            <% } %>
                            <a href="/shop?page=<%= totalPages %>"><%= totalPages %></a>
                        <% } %>
                    
                        <% if (currentPage < totalPages) { %>
                            <a href="/shop?page=<%= currentPage + 1 %>" class="next-arrow">
                                <i class="fa fa-long-arrow-right" aria-hidden="true"></i>
                            </a>
                        <% } %>
                    </div>
                    
                    
				</div>
				<!-- End Filter Bar -->
				<!-- Start Best Seller -->
				<section class="lattest-product-area pb-40 category-list">
					<div class="row">
						<!-- single product -->
                         
						<%for(let i=0;i< products.length; i++){%>

                            <div class="col-lg-4 col-md-6 col-sm-6 col-6">
                                <div class="single-product">
                                    <a class="hover-light" href="/productDetails?id=<%=products[i]._id%>">
                                    <img class="img-fluid" src="<%= products[i].productImage[0] %>" alt="<%= products[i].productName %>">
                                    <div class="product-details">
                                        <h6><%=products[i].productName%></h6>
                                        <div class="price">
                                            <h6>₹ <%= Math.round(products[i].salePrice)%>.00</h6>
                                            <h6 class="l-through">₹ <%=products[i].regularPrice%>.00</h6>
                                        </div>
                                      </a>
                                        <div class="prd-bottom">
        
                                            <a href="#" onclick="addToCart('<%=products[i]._id%>')" class="social-info">
                                                <span class="ti-bag"></span>
                                                <p class="hover-text">add to cart</p>
                                            </a>
                                            <a href="#" onclick="addToWishlist('<%=products[i]._id%>')" class="social-info">
                                                <span class="lnr lnr-heart"></span>
                                                <p class="hover-text">Wishlist</p>
                                            </a>
                                            <a href="/productDetails?id=<%=products[i]._id%>" class="social-info">
                                                <span class="lnr lnr-move"></span>
                                                <p class="hover-text">view more</p>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <%}%>

                            

						
					</div>
				</section>
				<!-- End Best Seller -->
				<!-- Start Filter Bar -->
				<div class="filter-bar d-flex flex-wrap align-items-center">
					<div class="sorting mr-auto">
						<select>
							<option value="1">Show 9</option>
							<!-- <option value="1">Show 12</option>
							<option value="1">Show 12</option> -->
						</select>
					</div>
					<div class="pagination">
                        <% if (currentPage > 1) { %>
                            <a href="/shop?page=<%= currentPage - 1 %>" class="prev-arrow">
                                <i class="fa fa-long-arrow-left" aria-hidden="true"></i>
                            </a>
                        <% } %>
                    
                        <% if (totalPages > 5 && currentPage > 3) { %>
                            <a href="/shop?page=1">1</a>
                            <% if (currentPage > 4) { %>
                                <a href="#" class="dot-dot">
                                    <i class="fa fa-ellipsis-h" aria-hidden="true"></i>
                                </a>
                            <% } %>
                        <% } %>
                    
                        <% for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) { %>
                            <a href="/shop?page=<%= i %>" class="<%= currentPage === i ? 'active' : '' %>"><%= i %></a>
                        <% } %>
                    
                        <% if (totalPages > 5 && currentPage < totalPages - 2) { %>
                            <% if (currentPage < totalPages - 3) { %>
                                <a href="#" class="dot-dot">
                                    <i class="fa fa-ellipsis-h" aria-hidden="true"></i>
                                </a>
                            <% } %>
                            <a href="/shop?page=<%= totalPages %>"><%= totalPages %></a>
                        <% } %>
                    
                        <% if (currentPage < totalPages) { %>
                            <a href="/shop?page=<%= currentPage + 1 %>" class="next-arrow">
                                <i class="fa fa-long-arrow-right" aria-hidden="true"></i>
                            </a>
                        <% } %>
                    </div>
				</div>
				<!-- End Filter Bar -->
			</div>
		</div>
	</div>

	<!-- Start related-product Area -->
	<section class="related-product-area section_gap">
		<div class="container">
			<div class="row justify-content-center">
				<div class="col-lg-6 text-center">
					<div class="section-title">
						<h1>Related Products</h1>
						<p>Explore our range of related products that complement your purchase. Each item is carefully selected to ensure the highest quality and satisfaction.</p>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-lg-9">
					<div class="row">
						<%for(let i=0;i< products.length; i++){%>
							<div class="col-lg-4 col-md-4 col-sm-6 mb-20 col-6">
								<div class="single-related-product d-flex">
									<a href="/productDetails?id=<%=products[i]._id%>"><img src="<%= products[i].productImage[0] %>" alt=""></a>
									<div class="desc">
										<a href="#" class="title"><%= products[i].productName.split('|')[0] %></a>
										<div class="price">
											<h6>₹ <%=products[i].salePrice.toLocaleString('en-IN')%></h6>
											<h6 class="l-through">₹ <%=products[i].regularPrice%></h6>
										</div>
									</div>
								</div>
							</div>
							<%}%>
						
					</div>
				</div>
				<div class="col-lg-3">
					<div class="ctg-right">
						<a href="#" target="_blank">
							<img class="img-fluid d-block mx-auto" src="img/category/c5.jpg" alt="">
						</a>
					</div>
				</div>
			</div>
		</div>
	</section>
	<!-- End related-product Area -->

	<!-- Modal Quick Product View -->
	<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="container relative">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
				<div class="product-quick-view">
					<div class="row align-items-center">
						<div class="col-lg-6">
							<div class="quick-view-carousel">
								<div class="item" style="background: url(img/organic-food/q1.jpg);">

								</div>
								<div class="item" style="background: url(img/organic-food/q1.jpg);">

								</div>
								<div class="item" style="background: url(img/organic-food/q1.jpg);">

								</div>
							</div>
						</div>
						<div class="col-lg-6">
							<div class="quick-view-content">
								<div class="top">
									<h3 class="head">Mill Oil 1000W Heater, White</h3>
									<div class="price d-flex align-items-center"><span class="lnr lnr-tag"></span> <span class="ml-10">$149.99</span></div>
									<div class="category">Category: <span>Household</span></div>
									<div class="available">Availibility: <span>In Stock</span></div>
								</div>
								<div class="middle">
									<p class="content">Mill Oil is an innovative oil filled radiator with the most modern technology. If you are
										looking for something that can make your interior look awesome, and at the same time give you the pleasant
										warm feeling during the winter.</p>
									<a href="#" class="view-full">View full Details <span class="lnr lnr-arrow-right"></span></a>
								</div>
								<div class="bottom">
									<div class="color-picker d-flex align-items-center">Color:
										<span class="single-pick"></span>
										<span class="single-pick"></span>
										<span class="single-pick"></span>
										<span class="single-pick"></span>
										<span class="single-pick"></span>
									</div>
									<div class="quantity-container d-flex align-items-center mt-15">
										Quantity:
										<input type="text" class="quantity-amount ml-15" value="1" />
										<div class="arrow-btn d-inline-flex flex-column">
											<button class="increase arrow" type="button" title="Increase Quantity"><span class="lnr lnr-chevron-up"></span></button>
											<button class="decrease arrow" type="button" title="Decrease Quantity"><span class="lnr lnr-chevron-down"></span></button>
										</div>

									</div>
									<div class="d-flex mt-20">
										<a href="#" class="view-btn color-2"><span>Add to Cart</span></a>
										<a href="#" class="like-btn"><span class="lnr lnr-layers"></span></a>
										<a href="#" class="like-btn"><span class="lnr lnr-heart"></span></a>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>


	<script>
		// Common function to handle authentication errors
function handleAuthError(title, message) {
  return Swal.fire({
    title: title,
    text: message,
    icon: "warning",
    showCancelButton: true,
    confirmButtonText: "Login",
    cancelButtonText: "Cancel",
    reverseButtons: true
  }).then((result) => {
    if (result.isConfirmed) {
      window.location.href = "/login";
    }
  });
}

// Add to wishlist function
function addToWishlist(productId) {
  $.ajax({
    url: '/addToWishlist',
    method: "POST",
    data: { productId: productId },
    success: (response) => {
      if (response.status) {
        Swal.fire({
          title: "Added to Wishlist",
          text: "The product has been added to your wishlist.",
          icon: "success",
          timer: 2000,
          showConfirmButton: false
        });
      } else {
        Swal.fire({
          title: "Already in Wishlist",
          text: response.message,
          icon: "info",
          timer: 2000,
          showConfirmButton: false
        });
      }
    },
    error: (xhr) => {
      if (xhr.status === 401) {
        handleAuthError(
          "Not Logged In",
          "You need to log in to add items to your wishlist."
        );
      } else {
        Swal.fire({
          title: "Error",
          text: "There was an error adding the product to your wishlist.",
          icon: "error",
          timer: 2000,
          showConfirmButton: false
        });
      }
    }
  });
}

// Add to cart function
function addToCart(productId) {
  $.ajax({
    url: '/addToCart',
    method: "POST",
    data: { productId: productId },
    success: (response) => {
      if (response.status) {
        Swal.fire({
			title: "Added to Cart",
			text: response.message,
			icon: "success",
			showCancelButton: true,  // Enables the second button
			confirmButtonText: "Cart", // Redirects to cart
			cancelButtonText: "OK",  // Closes the alert
			timer: 2000
		}).then((result) => {
			if (result.isConfirmed) {
				window.location.href = "/cart"; // Redirects to the cart page
			} else {
				location.reload(); // Reload to update cart UI
			}
		});

      } else {
        Swal.fire({
          title: "Error",
          text: response.message || "Unable to add to cart",
          icon: "error",
          timer: 2000,
          showConfirmButton: false
        });
      }
    },
    error: (xhr) => {
      if (xhr.status === 401) {
        handleAuthError(
          "Not Logged In",
          "You need to log in to add items to your cart."
        );
      } else {
        Swal.fire({
          title: "Error",
          text: "Stock limit reached or maximum 5 items per user",
          icon: "error",
          timer: 2000,
          showConfirmButton: false
        });
      }
    }
  });
}

	</script>





<%- include('../partials/user/footer') %>